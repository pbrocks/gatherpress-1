!function(){"use strict";var e,t={915:function(e,t,n){var a=window.wp.blocks,r=window.wp.element,s=window.moment,i=n.n(s),o=window.wp.blockEditor,l=window.wp.components,d=window.wp.data,c=window.wp.coreData;const m=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,a]of Object.entries(e)){let e=n;t&&(e+=t);const r=new CustomEvent(e,{detail:a});dispatchEvent(r)}};var u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"gatherpress/event-date","version":"0.1.1","title":"Event Date","category":"gatherpress","icon":"clock","example":{},"description":"The block with event dates.","attributes":{"blockId":{"type":"string"},"show_date_as_event":{"type":"boolean","default":true}},"supports":{"html":false},"textdomain":"gatherpress","editorScript":"file:./index.js","style":"file:./style-index.css"}'),p=window.wp.i18n,h=window.wp.plugins,v=window.wp.editPost;function _(){return"gp_event"===wp.data.select("core/editor").getCurrentPostType()}function g(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}var f=window.wp.apiFetch,w=n.n(f),E=window.React,P=window.wp.date;function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;G(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeStart:e};m(n),g()}function D(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class b extends E.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=S,this.getDateTimeStart=D,S=S.bind(this),D=D.bind(this)}componentWillUnmount(){S=this.updateDateTimeStart,D=this.getDateTimeStart}render(){const e=(0,P.__experimentalGetSettings)();return(0,P.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;C(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeEnd:e};m(n),g()}function y(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,x(),this.state.dateTime}function x(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),n=i()().valueOf()>i()(GatherPress.event_datetime.datetime_end).valueOf();t.removeNotice(e),n&&t.createNotice("warning",(0,p.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class O extends E.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=T,this.getDateTimeEnd=y,T=T.bind(this),y=y.bind(this),x()}componentWillUnmount(){T=this.updateDateTimeEnd,y=this.getDateTimeEnd}componentDidUpdate(){x()}render(){const e=(0,P.__experimentalGetSettings)();return(0,P.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const k="YYYY-MM-DDTHH:mm:ss";function G(e){const t=i()(GatherPress.event_datetime.datetime_end).valueOf(),n=i()(e).valueOf();n>=t&&T(i()(n).add(2,"hours").format(k)),x()}function C(e){const t=i()(GatherPress.event_datetime.datetime_start).valueOf(),n=i()(e).valueOf();n<=t&&S(i()(n).subtract(2,"hours").format(k)),x()}var Y=window.wp.compose;const M=(0,Y.withState)()((e=>{let{setState:t}=e;const n=(0,P.__experimentalGetSettings)(),a=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,r.createElement)(l.DateTimePicker,{currentDate:D(),onChange:e=>S(e,t),is12Hour:a})})),F=(0,Y.withState)()((e=>{let{setState:t}=e;const n=(0,P.__experimentalGetSettings)(),a=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,r.createElement)(l.DateTimePicker,{currentDate:y(),onChange:e=>T(e,t),is12Hour:a})})),j=i()().format(k);let I=GatherPress.event_datetime.datetime_start,R=GatherPress.event_datetime.datetime_end;(0,d.subscribe)((function(){const e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();_()&&e&&!t&&w()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:i()(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:i()(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((()=>{}))})),I=""!==I?i()(I).format(k):j,R=""!==R?i()(R).format(k):i()(j).add(2,"hours").format(k),GatherPress.event_datetime.datetime_start=I,GatherPress.event_datetime.datetime_end=R;const H=()=>(0,r.createElement)("section",null,(0,r.createElement)("h3",null,(0,p.__)("Date & time","gatherpress")),(0,r.createElement)(l.PanelRow,null,(0,r.createElement)("span",null,(0,p.__)("Start","gatherpress")),(0,r.createElement)(l.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:t,onToggle:n}=e;return(0,r.createElement)(l.Button,{onClick:n,"aria-expanded":t,isLink:!0},(0,r.createElement)(b,null))},renderContent:()=>(0,r.createElement)(M,null)})),(0,r.createElement)(l.PanelRow,null,(0,r.createElement)("span",null,(0,p.__)("End","gatherpress")),(0,r.createElement)(l.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:t,onToggle:n}=e;return(0,r.createElement)(l.Button,{onClick:n,"aria-expanded":t,isLink:!0},(0,r.createElement)(O,null))},renderContent:()=>(0,r.createElement)(F,null)})));var L=e=>{const{venue:t,setVenue:n}=e,a=(0,d.useDispatch)("core/editor").editPost,{unlockPostSaving:s}=(0,d.useDispatch)("core/editor"),i=(0,d.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),o=(0,d.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",i))),c=null==o?void 0:o.slug.replace("_venue_",""),u=i+":"+c;(0,r.useEffect)((()=>{var e;n(null!==(e=String(u))&&void 0!==e?e:""),m({setVenueId:c})}));let h=(0,d.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[t]);return h?(h=h.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),h.unshift({value:":",label:(0,p.__)("Choose a venue","gatherpress")})):h=[],(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.Flex,null,(0,r.createElement)(l.FlexItem,null,(0,p.__)("Venue","gatherpress")),(0,r.createElement)(l.FlexItem,null,(0,r.createElement)(l.SelectControl,{label:(0,p.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:t,onChange:e=>{(e=>{n(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];a({_gp_venue:t}),m({setVenueId:e[1]}),s()})(e)},options:h,style:{width:"11rem"}}))))};(0,h.registerPlugin)("gp-event-settings",{render:()=>{const[e,t]=(0,r.useState)("");return _()&&(0,r.createElement)(v.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,p.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,r.createElement)(H,null),(0,r.createElement)("hr",null),(0,r.createElement)(L,{venue:e,setVenue:t}))},icon:""});var N=window.ReactDOM,V=window.lodash,A=e=>{var t,n;const{name:a,option:s,value:i}=e.attrs,[o,m]=(0,r.useState)(null!==(t=JSON.parse(i))&&void 0!==t?t:"[]"),{usersList:u}=(0,d.useSelect)((e=>{const{getEntityRecords:t}=e(c.store);return{usersList:t("root","user",{per_page:-1,context:"view"})}}),[o]),h=null!==(n=null==u?void 0:u.reduce(((e,t)=>({...e,[t.name]:t})),{}))&&void 0!==n?n:{};return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.FormTokenField,{key:s,label:(0,p.__)("Select Users","gatherpress"),name:a,value:o&&o.map((e=>({id:e.id,slug:e.slug,value:e.name||e.value}))),suggestions:Object.keys(h),onChange:e=>{if(e.some((e=>"string"==typeof e&&!h[e])))return;const t=e.map((e=>"string"==typeof e?h[e]:e));if((0,V.includes)(t,null))return!1;m(t)},maxSuggestions:20}),(0,r.createElement)("input",{type:"hidden",id:s,name:a,value:o&&JSON.stringify(o.map((e=>({id:e.id,slug:e.slug,value:e.name||e.value}))))}))};const B=document.querySelectorAll('[data-gp_component_name="user-select"]');for(let e=0;e<B.length;e++){const t=JSON.parse(B[e].dataset.gp_component_attrs);(0,N.render)((0,r.createElement)(A,{attrs:t}),B[e])}(0,a.registerBlockType)(u,{edit:e=>{const{attributes:{show_date_as_event:t},setAttributes:n}=e,a=(0,o.useBlockProps)(),[s,m]=(0,r.useState)(GatherPress.event_datetime.datetime_start),[u,p]=(0,r.useState)(GatherPress.event_datetime.datetime_end);return function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,a]of Object.entries(e)){let e=n;t&&(e+=t),addEventListener(e,(e=>{a(e.detail)}),!1)}}({setDateTimeEnd:p,setDateTimeStart:m}),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(o.InspectorControls,null,(0,r.createElement)(l.PanelBody,{title:"Date Settings",icon:"calendar",initialOpen:!0},(0,r.createElement)((()=>{const[e,a]=(0,r.useState)(t),s=(0,d.useSelect)((e=>e("core/editor").getCurrentPostType()),[]),[i,o]=(0,c.useEntityProp)("postType",s,"meta");let m=i.show_date_as_event_date;return void 0===m&&(m=!0),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.PanelRow,null,(0,r.createElement)(l.CheckboxControl,{label:"Use Event Date",help:"Do you want to show the post date or event date?",checked:e,onChange:e=>{a(e),n({show_date_as_event:e}),o({...i,show_date_as_event_date:e})}})))}),null))),(0,r.createElement)("div",a,(0,r.createElement)(l.Flex,{justify:"normal",align:"flex-start",gap:"4"},(0,r.createElement)(l.FlexItem,{display:"flex",className:"gp-event-date__icon"},(0,r.createElement)(l.Icon,{icon:"clock"})),(0,r.createElement)(l.FlexItem,null,((e,t)=>{const n="dddd, MMMM D, YYYY",a=GatherPress.event_datetime.timezone;let r=n+" h:mm A z";return i()(e).format(n)===i()(t).format(n)&&(r="h:mm A z"),i()(e).format("dddd, MMMM D, YYYY h:mm A")+" to "+i().tz(t,a).format(r)})(s,u)))))},save:()=>null})}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=function(t,n,r,s){if(!n){var i=1/0;for(c=0;c<e.length;c++){n=e[c][0],r=e[c][1],s=e[c][2];for(var o=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[l])}))?n.splice(l--,1):(o=!1,s<i&&(i=s));if(o){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[n,r,s]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={591:0,42:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,s,i=n[0],o=n[1],l=n[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(l)var c=l(a)}for(t&&t(n);d<i.length;d++)s=i[d],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(c)},n=self.webpackChunkgatherpress=self.webpackChunkgatherpress||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var r=a.O(void 0,[42],(function(){return a(915)}));r=a.O(r)}();